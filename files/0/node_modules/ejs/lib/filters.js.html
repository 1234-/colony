<h1>filters.js</h1>
<pre><code class="lang-js"><span class="comment">/*!
 * EJS - Filters
 * Copyright(c) 2010 TJ Holowaychuk &lt;tj@vision-media.ca>
 * MIT Licensed
 */</span>

<span class="comment">/**
 * First element of the target `obj`.
 */</span>

exports.first = <span class="keyword">function</span>(obj) {
  <span class="keyword">return</span> obj[<span class="number">0</span>];
};

<span class="comment">/**
 * Last element of the target `obj`.
 */</span>

exports.last = <span class="keyword">function</span>(obj) {
  <span class="keyword">return</span> obj[obj.length - <span class="number">1</span>];
};

<span class="comment">/**
 * Capitalize the first letter of the target `str`.
 */</span>

exports.capitalize = <span class="keyword">function</span>(str){
  str = String(str);
  <span class="keyword">return</span> str[<span class="number">0</span>].toUpperCase() + str.substr(<span class="number">1</span>, str.length);
};

<span class="comment">/**
 * Downcase the target `str`.
 */</span>

exports.downcase = <span class="keyword">function</span>(str){
  <span class="keyword">return</span> String(str).toLowerCase();
};

<span class="comment">/**
 * Uppercase the target `str`.
 */</span>

exports.upcase = <span class="keyword">function</span>(str){
  <span class="keyword">return</span> String(str).toUpperCase();
};

<span class="comment">/**
 * Sort the target `obj`.
 */</span>

exports.sort = <span class="keyword">function</span>(obj){
  <span class="keyword">return</span> Object.create(obj).sort();
};

<span class="comment">/**
 * Sort the target `obj` by the given `prop` ascending.
 */</span>

exports.sort_by = <span class="keyword">function</span>(obj, prop){
  <span class="keyword">return</span> Object.create(obj).sort(<span class="keyword">function</span>(a, b){
    a = a[prop], b = b[prop];
    <span class="keyword">if</span> (a > b) <span class="keyword">return</span> <span class="number">1</span>;
    <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> -<span class="number">1</span>;
    <span class="keyword">return</span> <span class="number">0</span>;
  });
};

<span class="comment">/**
 * Size or length of the target `obj`.
 */</span>

exports.size = exports.length = <span class="keyword">function</span>(obj) {
  <span class="keyword">return</span> obj.length;
};

<span class="comment">/**
 * Add `a` and `b`.
 */</span>

exports.plus = <span class="keyword">function</span>(a, b){
  <span class="keyword">return</span> Number(a) + Number(b);
};

<span class="comment">/**
 * Subtract `b` from `a`.
 */</span>

exports.minus = <span class="keyword">function</span>(a, b){
  <span class="keyword">return</span> Number(a) - Number(b);
};

<span class="comment">/**
 * Multiply `a` by `b`.
 */</span>

exports.times = <span class="keyword">function</span>(a, b){
  <span class="keyword">return</span> Number(a) * Number(b);
};

<span class="comment">/**
 * Divide `a` by `b`.
 */</span>

exports.divided_by = <span class="keyword">function</span>(a, b){
  <span class="keyword">return</span> Number(a) / Number(b);
};

<span class="comment">/**
 * Join `obj` with the given `str`.
 */</span>

exports.join = <span class="keyword">function</span>(obj, str){
  <span class="keyword">return</span> obj.join(str || <span class="string">', '</span>);
};

<span class="comment">/**
 * Truncate `str` to `len`.
 */</span>

exports.truncate = <span class="keyword">function</span>(str, len){
  str = String(str);
  <span class="keyword">return</span> str.substr(<span class="number">0</span>, len);
};

<span class="comment">/**
 * Truncate `str` to `n` words.
 */</span>

exports.truncate_words = <span class="keyword">function</span>(str, n){
  <span class="keyword">var</span> str = String(str)
    , words = str.split(<span class="regexp">/ +/</span>);
  <span class="keyword">return</span> words.slice(<span class="number">0</span>, n).join(<span class="string">' '</span>);
};

<span class="comment">/**
 * Replace `pattern` with `substitution` in `str`.
 */</span>

exports.replace = <span class="keyword">function</span>(str, pattern, substitution){
  <span class="keyword">return</span> String(str).replace(pattern, substitution || <span class="string">''</span>);
};

<span class="comment">/**
 * Prepend `val` to `obj`.
 */</span>

exports.prepend = <span class="keyword">function</span>(obj, val){
  <span class="keyword">return</span> Array.isArray(obj)
    ? [val].concat(obj)
    : val + obj;
};

<span class="comment">/**
 * Append `val` to `obj`.
 */</span>

exports.append = <span class="keyword">function</span>(obj, val){
  <span class="keyword">return</span> Array.isArray(obj)
    ? obj.concat(val)
    : obj + val;
};

<span class="comment">/**
 * Map the given `prop`.
 */</span>

exports.map = <span class="keyword">function</span>(arr, prop){
  <span class="keyword">return</span> arr.map(<span class="keyword">function</span>(obj){
    <span class="keyword">return</span> obj[prop];
  });
};

<span class="comment">/**
 * Reverse the given `obj`.
 */</span>

exports.reverse = <span class="keyword">function</span>(obj){
  <span class="keyword">return</span> Array.isArray(obj)
    ? obj.reverse()
    : String(obj).split(<span class="string">''</span>).reverse().join(<span class="string">''</span>);
};

<span class="comment">/**
 * Get `prop` of the given `obj`.
 */</span>

exports.get = <span class="keyword">function</span>(obj, prop){
  <span class="keyword">return</span> obj[prop];
};

<span class="comment">/**
 * Packs the given `obj` into json string
 */</span>
exports.json = <span class="keyword">function</span>(obj){
  <span class="keyword">return</span> JSON.stringify(obj);
};</code></pre>