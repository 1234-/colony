<h1>CSSImportRule.js</h1>
<pre><code class="lang-js"><span class="comment">//.CommonJS</span>
<span class="keyword">var</span> CSSOM = {
	CSSRule: require(<span class="string">"./CSSRule"</span>).CSSRule,
	CSSStyleSheet: require(<span class="string">"./CSSStyleSheet"</span>).CSSStyleSheet,
	MediaList: require(<span class="string">"./MediaList"</span>).MediaList
};
<span class="comment">///CommonJS</span>


<span class="comment">/**
 * @constructor
 * @see http://dev.w3.org/csswg/cssom/#cssimportrule
 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule
 */</span>
CSSOM.CSSImportRule = <span class="function"><span class="keyword">function</span> <span class="title">CSSImportRule</span><span class="params">()</span> {</span>
	CSSOM.CSSRule.call(<span class="keyword">this</span>);
	<span class="keyword">this</span>.href = <span class="string">""</span>;
	<span class="keyword">this</span>.media = <span class="keyword">new</span> CSSOM.MediaList;
	<span class="keyword">this</span>.styleSheet = <span class="keyword">new</span> CSSOM.CSSStyleSheet;
};

CSSOM.CSSImportRule.prototype = <span class="keyword">new</span> CSSOM.CSSRule;
CSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;
CSSOM.CSSImportRule.prototype.type = <span class="number">3</span>;
CSSOM.CSSImportRule.prototype.__defineGetter__(<span class="string">"cssText"</span>, <span class="keyword">function</span>() {
	<span class="keyword">var</span> mediaText = <span class="keyword">this</span>.media.mediaText;
	<span class="keyword">return</span> <span class="string">"@import url("</span> + <span class="keyword">this</span>.href + <span class="string">")"</span> + (mediaText ? <span class="string">" "</span> + mediaText : <span class="string">""</span>) + <span class="string">";"</span>;
});

CSSOM.CSSImportRule.prototype.__defineSetter__(<span class="string">"cssText"</span>, <span class="keyword">function</span>(cssText) {
	<span class="keyword">var</span> i = <span class="number">0</span>;

	<span class="comment">/**
	 * @import url(partial.css) screen, handheld;
	 *        ||               |
	 *        after-import     media
	 *         |
	 *         url
	 */</span>
	<span class="keyword">var</span> state = <span class="string">''</span>;

	<span class="keyword">var</span> buffer = <span class="string">''</span>;
	<span class="keyword">var</span> index;
	<span class="keyword">var</span> mediaText = <span class="string">''</span>;
	<span class="keyword">for</span> (<span class="keyword">var</span> character; character = cssText.charAt(i); i++) {

		<span class="keyword">switch</span> (character) {
			<span class="keyword">case</span> <span class="string">' '</span>:
			<span class="keyword">case</span> <span class="string">'\t'</span>:
			<span class="keyword">case</span> <span class="string">'\r'</span>:
			<span class="keyword">case</span> <span class="string">'\n'</span>:
			<span class="keyword">case</span> <span class="string">'\f'</span>:
				<span class="keyword">if</span> (state === <span class="string">'after-import'</span>) {
					state = <span class="string">'url'</span>;
				} <span class="keyword">else</span> {
					buffer += character;
				}
				<span class="keyword">break</span>;

			<span class="keyword">case</span> <span class="string">'@'</span>:
				<span class="keyword">if</span> (!state &amp;&amp; cssText.indexOf(<span class="string">'@import'</span>, i) === i) {
					state = <span class="string">'after-import'</span>;
					i += <span class="string">'import'</span>.length;
					buffer = <span class="string">''</span>;
				}
				<span class="keyword">break</span>;

			<span class="keyword">case</span> <span class="string">'u'</span>:
				<span class="keyword">if</span> (state === <span class="string">'url'</span> &amp;&amp; cssText.indexOf(<span class="string">'url('</span>, i) === i) {
					index = cssText.indexOf(<span class="string">')'</span>, i + <span class="number">1</span>);
					<span class="keyword">if</span> (index === -<span class="number">1</span>) {
						<span class="keyword">throw</span> i + <span class="string">': ")" not found'</span>;
					}
					i += <span class="string">'url('</span>.length;
					<span class="keyword">var</span> url = cssText.slice(i, index);
					<span class="keyword">if</span> (url[<span class="number">0</span>] === url[url.length - <span class="number">1</span>]) {
						<span class="keyword">if</span> (url[<span class="number">0</span>] === <span class="string">'"'</span> || url[<span class="number">0</span>] === <span class="string">"'"</span>) {
							url = url.slice(<span class="number">1</span>, -<span class="number">1</span>);
						}
					}
					<span class="keyword">this</span>.href = url;
					i = index;
					state = <span class="string">'media'</span>;
				}
				<span class="keyword">break</span>;

			<span class="keyword">case</span> <span class="string">'"'</span>:
				<span class="keyword">if</span> (state === <span class="string">'url'</span>) {
					index = cssText.indexOf(<span class="string">'"'</span>, i + <span class="number">1</span>);
					<span class="keyword">if</span> (!index) {
						<span class="keyword">throw</span> i + <span class="string">": '\"' not found"</span>;
					}
					<span class="keyword">this</span>.href = cssText.slice(i + <span class="number">1</span>, index);
					i = index;
					state = <span class="string">'media'</span>;
				}
				<span class="keyword">break</span>;

			<span class="keyword">case</span> <span class="string">"'"</span>:
				<span class="keyword">if</span> (state === <span class="string">'url'</span>) {
					index = cssText.indexOf(<span class="string">"'"</span>, i + <span class="number">1</span>);
					<span class="keyword">if</span> (!index) {
						<span class="keyword">throw</span> i + <span class="string">': "\'" not found'</span>;
					}
					<span class="keyword">this</span>.href = cssText.slice(i + <span class="number">1</span>, index);
					i = index;
					state = <span class="string">'media'</span>;
				}
				<span class="keyword">break</span>;

			<span class="keyword">case</span> <span class="string">';'</span>:
				<span class="keyword">if</span> (state === <span class="string">'media'</span>) {
					<span class="keyword">if</span> (buffer) {
						<span class="keyword">this</span>.media.mediaText = buffer.trim();
					}
				}
				<span class="keyword">break</span>;

			<span class="keyword">default</span>:
				<span class="keyword">if</span> (state === <span class="string">'media'</span>) {
					buffer += character;
				}
				<span class="keyword">break</span>;
		}
	}
});


<span class="comment">//.CommonJS</span>
exports.CSSImportRule = CSSOM.CSSImportRule;
<span class="comment">///CommonJS</span>
</code></pre>