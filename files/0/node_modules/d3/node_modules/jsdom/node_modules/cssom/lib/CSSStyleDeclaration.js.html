<h1>CSSStyleDeclaration.js</h1>
<pre><code class="lang-js"><span class="comment">//.CommonJS</span>
<span class="keyword">var</span> CSSOM = {};
<span class="comment">///CommonJS</span>


<span class="comment">/**
 * @constructor
 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration
 */</span>
CSSOM.CSSStyleDeclaration = <span class="function"><span class="keyword">function</span> <span class="title">CSSStyleDeclaration</span><span class="params">()</span>{</span>
	<span class="keyword">this</span>.length = <span class="number">0</span>;
	<span class="keyword">this</span>.parentRule = <span class="literal">null</span>;

	<span class="comment">// NON-STANDARD</span>
	<span class="keyword">this</span>._importants = {};
};


CSSOM.CSSStyleDeclaration.prototype = {

	constructor: CSSOM.CSSStyleDeclaration,

	<span class="comment">/**
	 *
	 * @param {string} name
	 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue
	 * @return {string} the value of the property if it has been explicitly set for this declaration block.
	 * Returns the empty string if the property has not been set.
	 */</span>
	getPropertyValue: <span class="keyword">function</span>(name) {
		<span class="keyword">return</span> <span class="keyword">this</span>[name] || <span class="string">""</span>;
	},

	<span class="comment">/**
	 *
	 * @param {string} name
	 * @param {string} value
	 * @param {string} [priority=null] "important" or null
	 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty
	 */</span>
	setProperty: <span class="keyword">function</span>(name, value, priority) {
		<span class="keyword">if</span> (<span class="keyword">this</span>[name]) {
			<span class="comment">// Property already exist. Overwrite it.</span>
			<span class="keyword">var</span> index = Array.prototype.indexOf.call(<span class="keyword">this</span>, name);
			<span class="keyword">if</span> (index &lt; <span class="number">0</span>) {
				<span class="keyword">this</span>[<span class="keyword">this</span>.length] = name;
				<span class="keyword">this</span>.length++;
			}
		} <span class="keyword">else</span> {
			<span class="comment">// New property.</span>
			<span class="keyword">this</span>[<span class="keyword">this</span>.length] = name;
			<span class="keyword">this</span>.length++;
		}
		<span class="keyword">this</span>[name] = value;
		<span class="keyword">this</span>._importants[name] = priority;
	},

	<span class="comment">/**
	 *
	 * @param {string} name
	 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty
	 * @return {string} the value of the property if it has been explicitly set for this declaration block.
	 * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.
	 */</span>
	removeProperty: <span class="keyword">function</span>(name) {
		<span class="keyword">if</span> (!(name <span class="keyword">in</span> <span class="keyword">this</span>)) {
			<span class="keyword">return</span> <span class="string">""</span>;
		}
		<span class="keyword">var</span> index = Array.prototype.indexOf.call(<span class="keyword">this</span>, name);
		<span class="keyword">if</span> (index &lt; <span class="number">0</span>) {
			<span class="keyword">return</span> <span class="string">""</span>;
		}
		<span class="keyword">var</span> prevValue = <span class="keyword">this</span>[name];
		<span class="keyword">this</span>[name] = <span class="string">""</span>;

		<span class="comment">// That's what WebKit and Opera do</span>
		Array.prototype.splice.call(<span class="keyword">this</span>, index, <span class="number">1</span>);

		<span class="comment">// That's what Firefox does</span>
		<span class="comment">//this[index] = ""</span>

		<span class="keyword">return</span> prevValue;
	},

	getPropertyCSSValue: <span class="keyword">function</span>() {
		<span class="comment">//FIXME</span>
	},

	<span class="comment">/**
	 *
	 * @param {String} name
	 */</span>
	getPropertyPriority: <span class="keyword">function</span>(name) {
		<span class="keyword">return</span> <span class="keyword">this</span>._importants[name] || <span class="string">""</span>;
	},


	<span class="comment">/**
	 *   element.style.overflow = "auto"
	 *   element.style.getPropertyShorthand("overflow-x")
	 *   -> "overflow"
	 */</span>
	getPropertyShorthand: <span class="keyword">function</span>() {
		<span class="comment">//FIXME</span>
	},

	isPropertyImplicit: <span class="keyword">function</span>() {
		<span class="comment">//FIXME</span>
	},

	<span class="comment">// Doesn't work in IE &lt; 9</span>
	get cssText(){
		<span class="keyword">var</span> properties = [];
		<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>, length=<span class="keyword">this</span>.length; i &lt; length; ++i) {
			<span class="keyword">var</span> name = <span class="keyword">this</span>[i];
			<span class="keyword">var</span> value = <span class="keyword">this</span>.getPropertyValue(name);
			<span class="keyword">var</span> priority = <span class="keyword">this</span>.getPropertyPriority(name);
			<span class="keyword">if</span> (priority) {
				priority = <span class="string">" !"</span> + priority;
			}
			properties[i] = name + <span class="string">": "</span> + value + priority + <span class="string">";"</span>;
		}
		<span class="keyword">return</span> properties.join(<span class="string">" "</span>);
	},

	set cssText(cssText){
		<span class="keyword">var</span> i, name;
		<span class="keyword">for</span> (i = <span class="keyword">this</span>.length; i--;) {
			name = <span class="keyword">this</span>[i];
			<span class="keyword">this</span>[name] = <span class="string">""</span>;
		}
		Array.prototype.splice.call(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">this</span>.length);
		<span class="keyword">this</span>._importants = {};

		<span class="keyword">var</span> dummyRule = CSSOM.parse(<span class="string">'#bogus{'</span> + cssText + <span class="string">'}'</span>).cssRules[<span class="number">0</span>].style;
		<span class="keyword">var</span> length = dummyRule.length;
		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; ++i) {
			name = dummyRule[i];
			<span class="keyword">this</span>.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));
		}
	}
};


<span class="comment">//.CommonJS</span>
exports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;
CSSOM.parse = require(<span class="string">'./parse'</span>).parse; <span class="comment">// Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js</span>
<span class="comment">///CommonJS</span>
</code></pre>