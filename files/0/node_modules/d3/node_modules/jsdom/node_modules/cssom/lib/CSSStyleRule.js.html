<h1>CSSStyleRule.js</h1>
<pre><code class="lang-js"><span class="comment">//.CommonJS</span>
<span class="keyword">var</span> CSSOM = {
	CSSStyleDeclaration: require(<span class="string">"./CSSStyleDeclaration"</span>).CSSStyleDeclaration,
	CSSRule: require(<span class="string">"./CSSRule"</span>).CSSRule
};
<span class="comment">///CommonJS</span>


<span class="comment">/**
 * @constructor
 * @see http://dev.w3.org/csswg/cssom/#cssstylerule
 * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule
 */</span>
CSSOM.CSSStyleRule = <span class="function"><span class="keyword">function</span> <span class="title">CSSStyleRule</span><span class="params">()</span> {</span>
	CSSOM.CSSRule.call(<span class="keyword">this</span>);
	<span class="keyword">this</span>.selectorText = <span class="string">""</span>;
	<span class="keyword">this</span>.style = <span class="keyword">new</span> CSSOM.CSSStyleDeclaration;
	<span class="keyword">this</span>.style.parentRule = <span class="keyword">this</span>;
};

CSSOM.CSSStyleRule.prototype = <span class="keyword">new</span> CSSOM.CSSRule;
CSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;
CSSOM.CSSStyleRule.prototype.type = <span class="number">1</span>;

CSSOM.CSSStyleRule.prototype.__defineGetter__(<span class="string">"cssText"</span>, <span class="keyword">function</span>() {
	<span class="keyword">var</span> text;
	<span class="keyword">if</span> (<span class="keyword">this</span>.selectorText) {
		text = <span class="keyword">this</span>.selectorText + <span class="string">" {"</span> + <span class="keyword">this</span>.style.cssText + <span class="string">"}"</span>;
	} <span class="keyword">else</span> {
		text = <span class="string">""</span>;
	}
	<span class="keyword">return</span> text;
});

CSSOM.CSSStyleRule.prototype.__defineSetter__(<span class="string">"cssText"</span>, <span class="keyword">function</span>(cssText) {
	<span class="keyword">var</span> rule = CSSOM.CSSStyleRule.parse(cssText);
	<span class="keyword">this</span>.style = rule.style;
	<span class="keyword">this</span>.selectorText = rule.selectorText;
});


<span class="comment">/**
 * NON-STANDARD
 * lightweight version of parse.js.
 * @param {string} ruleText
 * @return CSSStyleRule
 */</span>
CSSOM.CSSStyleRule.parse = <span class="keyword">function</span>(ruleText) {
	<span class="keyword">var</span> i = <span class="number">0</span>;
	<span class="keyword">var</span> state = <span class="string">"selector"</span>;
	<span class="keyword">var</span> index;
	<span class="keyword">var</span> j = i;
	<span class="keyword">var</span> buffer = <span class="string">""</span>;

	<span class="keyword">var</span> SIGNIFICANT_WHITESPACE = {
		<span class="string">"selector"</span>: <span class="literal">true</span>,
		<span class="string">"value"</span>: <span class="literal">true</span>
	};

	<span class="keyword">var</span> styleRule = <span class="keyword">new</span> CSSOM.CSSStyleRule;
	<span class="keyword">var</span> selector, name, value, priority=<span class="string">""</span>;

	<span class="keyword">for</span> (<span class="keyword">var</span> character; character = ruleText.charAt(i); i++) {

		<span class="keyword">switch</span> (character) {

		<span class="keyword">case</span> <span class="string">" "</span>:
		<span class="keyword">case</span> <span class="string">"\t"</span>:
		<span class="keyword">case</span> <span class="string">"\r"</span>:
		<span class="keyword">case</span> <span class="string">"\n"</span>:
		<span class="keyword">case</span> <span class="string">"\f"</span>:
			<span class="keyword">if</span> (SIGNIFICANT_WHITESPACE[state]) {
				<span class="comment">// Squash 2 or more white-spaces in the row into 1</span>
				<span class="keyword">switch</span> (ruleText.charAt(i - <span class="number">1</span>)) {
					<span class="keyword">case</span> <span class="string">" "</span>:
					<span class="keyword">case</span> <span class="string">"\t"</span>:
					<span class="keyword">case</span> <span class="string">"\r"</span>:
					<span class="keyword">case</span> <span class="string">"\n"</span>:
					<span class="keyword">case</span> <span class="string">"\f"</span>:
						<span class="keyword">break</span>;
					<span class="keyword">default</span>:
						buffer += <span class="string">" "</span>;
						<span class="keyword">break</span>;
				}
			}
			<span class="keyword">break</span>;

		<span class="comment">// String</span>
		<span class="keyword">case</span> <span class="string">'"'</span>:
			j = i + <span class="number">1</span>;
			index = ruleText.indexOf(<span class="string">'"'</span>, j) + <span class="number">1</span>;
			<span class="keyword">if</span> (!index) {
				<span class="keyword">throw</span> <span class="string">'" is missing'</span>;
			}
			buffer += ruleText.slice(i, index);
			i = index - <span class="number">1</span>;
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">"'"</span>:
			j = i + <span class="number">1</span>;
			index = ruleText.indexOf(<span class="string">"'"</span>, j) + <span class="number">1</span>;
			<span class="keyword">if</span> (!index) {
				<span class="keyword">throw</span> <span class="string">"' is missing"</span>;
			}
			buffer += ruleText.slice(i, index);
			i = index - <span class="number">1</span>;
			<span class="keyword">break</span>;

		<span class="comment">// Comment</span>
		<span class="keyword">case</span> <span class="string">"/"</span>:
			<span class="keyword">if</span> (ruleText.charAt(i + <span class="number">1</span>) === <span class="string">"*"</span>) {
				i += <span class="number">2</span>;
				index = ruleText.indexOf(<span class="string">"*/"</span>, i);
				<span class="keyword">if</span> (index === -<span class="number">1</span>) {
					<span class="keyword">throw</span> <span class="keyword">new</span> SyntaxError(<span class="string">"Missing */"</span>);
				} <span class="keyword">else</span> {
					i = index + <span class="number">1</span>;
				}
			} <span class="keyword">else</span> {
				buffer += character;
			}
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">"{"</span>:
			<span class="keyword">if</span> (state === <span class="string">"selector"</span>) {
				styleRule.selectorText = buffer.trim();
				buffer = <span class="string">""</span>;
				state = <span class="string">"name"</span>;
			}
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">":"</span>:
			<span class="keyword">if</span> (state === <span class="string">"name"</span>) {
				name = buffer.trim();
				buffer = <span class="string">""</span>;
				state = <span class="string">"value"</span>;
			} <span class="keyword">else</span> {
				buffer += character;
			}
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">"!"</span>:
			<span class="keyword">if</span> (state === <span class="string">"value"</span> &amp;&amp; ruleText.indexOf(<span class="string">"!important"</span>, i) === i) {
				priority = <span class="string">"important"</span>;
				i += <span class="string">"important"</span>.length;
			} <span class="keyword">else</span> {
				buffer += character;
			}
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">";"</span>:
			<span class="keyword">if</span> (state === <span class="string">"value"</span>) {
				styleRule.style.setProperty(name, buffer.trim(), priority);
				priority = <span class="string">""</span>;
				buffer = <span class="string">""</span>;
				state = <span class="string">"name"</span>;
			} <span class="keyword">else</span> {
				buffer += character;
			}
			<span class="keyword">break</span>;

		<span class="keyword">case</span> <span class="string">"}"</span>:
			<span class="keyword">if</span> (state === <span class="string">"value"</span>) {
				styleRule.style.setProperty(name, buffer.trim(), priority);
				priority = <span class="string">""</span>;
				buffer = <span class="string">""</span>;
			} <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="string">"name"</span>) {
				<span class="keyword">break</span>;
			} <span class="keyword">else</span> {
				buffer += character;
			}
			state = <span class="string">"selector"</span>;
			<span class="keyword">break</span>;

		<span class="keyword">default</span>:
			buffer += character;
			<span class="keyword">break</span>;

		}
	}

	<span class="keyword">return</span> styleRule;

};


<span class="comment">//.CommonJS</span>
exports.CSSStyleRule = CSSOM.CSSStyleRule;
<span class="comment">///CommonJS</span>
</code></pre>