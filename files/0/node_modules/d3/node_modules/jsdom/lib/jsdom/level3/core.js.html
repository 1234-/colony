<h1>core.js</h1>
<pre><code class="lang-js"><span class="keyword">var</span> core          = require(<span class="string">"../level2/core"</span>).dom.level2.core,
    HtmlToDom     = require(<span class="string">'../browser/htmltodom'</span>).HtmlToDom,
    domToHtml     = require(<span class="string">'../browser/domtohtml'</span>).domToHtml,
    htmlencoding  = require(<span class="string">'../browser/htmlencoding'</span>),
    HTMLEncode    = htmlencoding.HTMLEncode,
    HTMLDecode    = htmlencoding.HTMLDecode;

<span class="comment">// modify cloned instance for more info check: https://github.com/tmpvar/jsdom/issues/325</span>
core = Object.create(core);

<span class="comment">/*
  valuetype DOMString sequence&lt;unsigned short>;
  typedef   unsigned long long DOMTimeStamp;
  typedef   any DOMUserData;
  typedef   Object DOMObject;

*/</span>
<span class="comment">// ExceptionCode</span>
core.VALIDATION_ERR                 = <span class="number">16</span>;
core.TYPE_MISMATCH_ERR              = <span class="number">17</span>;

<span class="comment">/*
  // Introduced in DOM Level 3:
  interface NameList {
    DOMString          getName(in unsigned long index);
    DOMString          getNamespaceURI(in unsigned long index);
    readonly attribute unsigned long   length;
    boolean            contains(in DOMString str);
    boolean            containsNS(in DOMString namespaceURI,
                                  in DOMString name);
  };

  // Introduced in DOM Level 3:
  interface DOMImplementationList {
    DOMImplementation  item(in unsigned long index);
    readonly attribute unsigned long   length;
  };

  // Introduced in DOM Level 3:
  interface DOMImplementationSource {
    DOMImplementation  getDOMImplementation(in DOMString features);
    DOMImplementationList getDOMImplementationList(in DOMString features);
  };
*/</span>


core.DOMImplementation.prototype.getFeature = <span class="keyword">function</span>(feature, version)  {

};

<span class="comment">/*
  interface Node {
    // Modified in DOM Level 3:
    Node               insertBefore(in Node newChild,
                                    in Node refChild)
                                        raises(DOMException);
    // Modified in DOM Level 3:
    Node               replaceChild(in Node newChild,
                                    in Node oldChild)
                                        raises(DOMException);
    // Modified in DOM Level 3:
    Node               removeChild(in Node oldChild)
                                        raises(DOMException);
    // Modified in DOM Level 3:
    Node               appendChild(in Node newChild)
                                        raises(DOMException);
    boolean            hasChildNodes();
    Node               cloneNode(in boolean deep);
    // Modified in DOM Level 3:
    void               normalize();
    // Introduced in DOM Level 3:
    readonly attribute DOMString       baseURI;
*/</span>

<span class="comment">// Compare Document Position</span>
<span class="keyword">var</span> DOCUMENT_POSITION_DISCONNECTED = core.Node.prototype.DOCUMENT_POSITION_DISCONNECTED = <span class="number">0x01</span>;
<span class="keyword">var</span> DOCUMENT_POSITION_PRECEDING    = core.Node.prototype.DOCUMENT_POSITION_PRECEDING    = <span class="number">0x02</span>;
<span class="keyword">var</span> DOCUMENT_POSITION_FOLLOWING    = core.Node.prototype.DOCUMENT_POSITION_FOLLOWING    = <span class="number">0x04</span>;
<span class="keyword">var</span> DOCUMENT_POSITION_CONTAINS     = core.Node.prototype.DOCUMENT_POSITION_CONTAINS     = <span class="number">0x08</span>;
<span class="keyword">var</span> DOCUMENT_POSITION_CONTAINED_BY = core.Node.prototype.DOCUMENT_POSITION_CONTAINED_BY = <span class="number">0x10</span>;
<span class="keyword">var</span> DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = core.Node.prototype.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = <span class="number">0x20</span>;
<span class="keyword">var</span> DOCUMENT_TYPE_NODE = core.Node.prototype.DOCUMENT_TYPE_NODE;

core.Node.prototype.compareDocumentPosition = <span class="function"><span class="keyword">function</span> <span class="title">compareDocumentPosition</span><span class="params">( otherNode )</span> {</span>
  <span class="keyword">if</span>( !(otherNode <span class="keyword">instanceof</span> core.Node) ) {
    <span class="keyword">throw</span> Error(<span class="string">"Comparing position against non-Node values is not allowed"</span>)
  }
  <span class="keyword">var</span> thisOwner, otherOwner;

  <span class="keyword">if</span>( <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.DOCUMENT_NODE)
    thisOwner = <span class="keyword">this</span>
  <span class="keyword">else</span>
    thisOwner = <span class="keyword">this</span>.ownerDocument

  <span class="keyword">if</span>( otherNode.nodeType === <span class="keyword">this</span>.DOCUMENT_NODE)
    otherOwner = otherNode
  <span class="keyword">else</span>
    otherOwner = otherNode.ownerDocument

  <span class="keyword">if</span>( <span class="keyword">this</span> === otherNode ) <span class="keyword">return</span> <span class="number">0</span>
  <span class="keyword">if</span>( <span class="keyword">this</span> === otherNode.ownerDocument ) <span class="keyword">return</span> DOCUMENT_POSITION_FOLLOWING + DOCUMENT_POSITION_CONTAINED_BY
  <span class="keyword">if</span>( <span class="keyword">this</span>.ownerDocument === otherNode ) <span class="keyword">return</span> DOCUMENT_POSITION_PRECEDING + DOCUMENT_POSITION_CONTAINS
  <span class="keyword">if</span>( thisOwner !== otherOwner ) <span class="keyword">return</span> DOCUMENT_POSITION_DISCONNECTED

  <span class="comment">// Text nodes for attributes does not have a _parentNode. So we need to find them as attribute child.</span>
  <span class="keyword">if</span>( <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.ATTRIBUTE_NODE &amp;&amp; <span class="keyword">this</span>._childNodes &amp;&amp; <span class="keyword">this</span>._childNodes.indexOf(otherNode) !== -<span class="number">1</span>)
    <span class="keyword">return</span> DOCUMENT_POSITION_FOLLOWING + DOCUMENT_POSITION_CONTAINED_BY

  <span class="keyword">if</span>( otherNode.nodeType === <span class="keyword">this</span>.ATTRIBUTE_NODE &amp;&amp; otherNode._childNodes &amp;&amp; otherNode._childNodes.indexOf(<span class="keyword">this</span>) !== -<span class="number">1</span>)
    <span class="keyword">return</span> DOCUMENT_POSITION_PRECEDING + DOCUMENT_POSITION_CONTAINS

  <span class="keyword">var</span> point = <span class="keyword">this</span>
  <span class="keyword">var</span> parents = [ ]
  <span class="keyword">var</span> previous = <span class="literal">null</span>
  <span class="keyword">while</span>( point ) {
    <span class="keyword">if</span>( point == otherNode ) <span class="keyword">return</span> DOCUMENT_POSITION_PRECEDING + DOCUMENT_POSITION_CONTAINS
    parents.push( point )
    point = point._parentNode
  }
  point = otherNode
  previous = <span class="literal">null</span>
  <span class="keyword">while</span>( point ) {
    <span class="keyword">if</span>( point == <span class="keyword">this</span> ) <span class="keyword">return</span> DOCUMENT_POSITION_FOLLOWING + DOCUMENT_POSITION_CONTAINED_BY
    <span class="keyword">var</span> location_index = parents.indexOf( point )
    <span class="keyword">if</span>( location_index !== -<span class="number">1</span>) {
     <span class="keyword">var</span> smallest_common_ancestor = parents[ location_index ]
     <span class="keyword">var</span> this_index = smallest_common_ancestor._childNodes.indexOf( parents[location_index - <span class="number">1</span>] )
     <span class="keyword">var</span> other_index = smallest_common_ancestor._childNodes.indexOf( previous )
     <span class="keyword">if</span>( this_index > other_index ) {
           <span class="keyword">return</span> DOCUMENT_POSITION_PRECEDING
     }
     <span class="keyword">else</span> {
       <span class="keyword">return</span> DOCUMENT_POSITION_FOLLOWING
     }
    }
    previous = point
    point = point._parentNode
  }
  <span class="keyword">return</span> DOCUMENT_POSITION_DISCONNECTED
};
<span class="comment">/*
    // Introduced in DOM Level 3:
             attribute DOMString       textContent;
                                        // raises(DOMException) on setting
                                        // raises(DOMException) on retrieval
*/</span>
core.Node.prototype.isSameNode = <span class="keyword">function</span>(other) {
  <span class="keyword">return</span> (other === <span class="keyword">this</span>);
};

core.Node.prototype.__defineGetter__(<span class="string">'textContent'</span>, <span class="keyword">function</span>() {
  <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.TEXT_NODE || <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.COMMENT_NODE || <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.ATTRIBUTE_NODE || <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.CDATA_SECTION_NODE) {
    <span class="keyword">return</span> <span class="keyword">this</span>.nodeValue;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.ELEMENT_NODE || <span class="keyword">this</span>.nodeType === <span class="keyword">this</span>.DOCUMENT_FRAGMENT_NODE) {
    <span class="keyword">var</span> out = <span class="string">''</span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.childNodes.length ; i += <span class="number">1</span>) {
      out += <span class="keyword">this</span>.childNodes[i].textContent || <span class="string">''</span>;
    }
    <span class="keyword">return</span> out;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> <span class="literal">null</span>;
  }
});

core.Node.prototype.__defineSetter__(<span class="string">'textContent'</span>, <span class="keyword">function</span>(txt) {
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="keyword">this</span>.childNodes.length; --i >=<span class="number">0</span>;) {
    <span class="keyword">this</span>.removeChild(<span class="keyword">this</span>.childNodes.item(i));
  }
  <span class="keyword">if</span> (txt !== <span class="string">""</span> &amp;&amp; txt != <span class="literal">null</span>) {
    <span class="keyword">this</span>.appendChild(<span class="keyword">this</span>._ownerDocument.createTextNode(txt));
  }
  <span class="keyword">return</span> txt;
});

<span class="comment">/*
    // Introduced in DOM Level 3:
    DOMString          lookupPrefix(in DOMString namespaceURI);
    // Introduced in DOM Level 3:
    boolean            isDefaultNamespace(in DOMString namespaceURI);
    // Introduced in DOM Level 3:
    DOMString          lookupNamespaceURI(in DOMString prefix);
*/</span>
<span class="comment">// Introduced in DOM Level 3:</span>
core.Node.prototype.isEqualNode = <span class="keyword">function</span>(other) {
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">var</span> diffValues = <span class="keyword">function</span>() {
    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arguments.length;i++) {
      <span class="keyword">var</span> k = arguments[i];
      <span class="keyword">if</span> (self[k] != other[k]) <span class="keyword">return</span>(<span class="literal">true</span>);
    }
    <span class="keyword">return</span>(<span class="literal">false</span>);
  };
  <span class="keyword">var</span> diffNamedNodeMaps = <span class="keyword">function</span>(snnm, onnm) {
    <span class="keyword">if</span> ((snnm == <span class="literal">null</span>) &amp;&amp; (onnm == <span class="literal">null</span>)) <span class="keyword">return</span>(<span class="literal">false</span>);
    <span class="keyword">if</span> ((snnm == <span class="literal">null</span>) || (onnm == <span class="literal">null</span>)) <span class="keyword">return</span>(<span class="literal">true</span>);
    <span class="keyword">if</span> (snnm.length != onnm.length) <span class="keyword">return</span>(<span class="literal">true</span>);
    <span class="keyword">var</span> js = [];
    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;onnm.length;j++) { js[j] = j }
    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;snnm.length;i++) {
      <span class="keyword">var</span> found=<span class="literal">false</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;js.length;j++) {
        <span class="keyword">if</span> (snnm.item(i).isEqualNode(onnm.item(js[j]))) {
          found = <span class="literal">true</span>;
          <span class="comment">// in order to be 100% accurate, we remove index values from consideration once they've matched</span>
          js.splice(j,<span class="number">1</span>);
          <span class="keyword">break</span>;
        }
      }
      <span class="keyword">if</span> (!found) <span class="keyword">return</span>(<span class="literal">true</span>);
    }
    <span class="keyword">return</span>(<span class="literal">false</span>);
  };
  <span class="keyword">var</span> diffNodeLists = <span class="keyword">function</span>(snl, onl) {
    <span class="keyword">if</span> ((snl == <span class="literal">null</span>) &amp;&amp; (onl == <span class="literal">null</span>)) <span class="keyword">return</span>(<span class="literal">false</span>);
    <span class="keyword">if</span> ((snl == <span class="literal">null</span>) || (onl == <span class="literal">null</span>)) <span class="keyword">return</span>(<span class="literal">true</span>);
    <span class="keyword">if</span> (snl.length != onl.length) <span class="keyword">return</span>(<span class="literal">true</span>);
    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;snl.length;i++) {
      <span class="keyword">if</span> (!snl.item(i).isEqualNode(onl.item(i))) <span class="keyword">return</span>(<span class="literal">true</span>);
    }
    <span class="keyword">return</span>(<span class="literal">false</span>);
  };
  <span class="keyword">if</span> (!other) <span class="keyword">return</span>(<span class="literal">false</span>);
  <span class="keyword">if</span> (<span class="keyword">this</span>.isSameNode(other)) <span class="keyword">return</span>(<span class="literal">true</span>);
  <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType != other.nodeType) <span class="keyword">return</span>(<span class="literal">false</span>);
  <span class="keyword">if</span> (diffValues(<span class="string">'nodeName'</span>, <span class="string">'localName'</span>, <span class="string">'namespaceURI'</span>, <span class="string">'prefix'</span>, <span class="string">'nodeValue'</span>)) <span class="keyword">return</span>(<span class="literal">false</span>);
  <span class="keyword">if</span> (diffNamedNodeMaps(<span class="keyword">this</span>.attributes, other.attributes)) <span class="keyword">return</span>(<span class="literal">false</span>);
  <span class="keyword">if</span> (diffNodeLists(<span class="keyword">this</span>.childNodes, other.childNodes)) <span class="keyword">return</span>(<span class="literal">false</span>);
  <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType == DOCUMENT_TYPE_NODE) {
    <span class="keyword">if</span> (diffValues(<span class="string">'publicId'</span>, <span class="string">'systemId'</span>, <span class="string">'internalSubset'</span>)) <span class="keyword">return</span>(<span class="literal">false</span>);
    <span class="keyword">if</span> (diffNamedNodeMaps(<span class="keyword">this</span>.entities, other.entities)) <span class="keyword">return</span>(<span class="literal">false</span>);
    <span class="keyword">if</span> (diffNamedNodeMaps(<span class="keyword">this</span>.notations, other.notations)) <span class="keyword">return</span>(<span class="literal">false</span>);
  }
  <span class="keyword">return</span> (<span class="literal">true</span>);
};
<span class="comment">/*
    // Introduced in DOM Level 3:
    DOMObject          getFeature(in DOMString feature,
                                  in DOMString version);
*/</span>
<span class="comment">// Introduced in DOM Level 3:</span>
core.Node.prototype.setUserData = <span class="keyword">function</span>(key, data, handler) {
  <span class="keyword">var</span> r = <span class="keyword">this</span>[key] || <span class="literal">null</span>;
  <span class="keyword">this</span>[key] = data;
  <span class="keyword">return</span>(r);
};

<span class="comment">// Introduced in DOM Level 3:</span>
core.Node.prototype.getUserData = <span class="keyword">function</span>(key) {
  <span class="keyword">var</span> r = <span class="keyword">this</span>[key] || <span class="literal">null</span>;
  <span class="keyword">return</span>(r);
};
<span class="comment">/*
  interface NodeList {
    Node               item(in unsigned long index);
    readonly attribute unsigned long   length;
  };

  interface NamedNodeMap {
    Node               getNamedItem(in DOMString name);
    Node               setNamedItem(in Node arg)
                                        raises(DOMException);
    Node               removeNamedItem(in DOMString name)
                                        raises(DOMException);
    Node               item(in unsigned long index);
    readonly attribute unsigned long   length;
    // Introduced in DOM Level 2:
    Node               getNamedItemNS(in DOMString namespaceURI,
                                      in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Node               setNamedItemNS(in Node arg)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Node               removeNamedItemNS(in DOMString namespaceURI,
                                         in DOMString localName)
                                        raises(DOMException);
  };

  interface CharacterData : Node {
             attribute DOMString       data;
                                        // raises(DOMException) on setting
                                        // raises(DOMException) on retrieval

    readonly attribute unsigned long   length;
    DOMString          substringData(in unsigned long offset,
                                     in unsigned long count)
                                        raises(DOMException);
    void               appendData(in DOMString arg)
                                        raises(DOMException);
    void               insertData(in unsigned long offset,
                                  in DOMString arg)
                                        raises(DOMException);
    void               deleteData(in unsigned long offset,
                                  in unsigned long count)
                                        raises(DOMException);
    void               replaceData(in unsigned long offset,
                                   in unsigned long count,
                                   in DOMString arg)
                                        raises(DOMException);
  };

  interface Attr : Node {
    readonly attribute DOMString       name;
    readonly attribute boolean         specified;
             attribute DOMString       value;
                                        // raises(DOMException) on setting

    // Introduced in DOM Level 2:
    readonly attribute Element         ownerElement;
    // Introduced in DOM Level 3:
    readonly attribute TypeInfo        schemaTypeInfo;

*/</span>
    <span class="comment">// Introduced in DOM Level 3:</span>
core.Attr.prototype.__defineGetter__(<span class="string">'isId'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> (<span class="keyword">this</span>.name.toLowerCase() === <span class="string">'id'</span>);
});
<span class="comment">/*
  };

  interface Element : Node {
    readonly attribute DOMString       tagName;
    DOMString          getAttribute(in DOMString name);
    void               setAttribute(in DOMString name,
                                    in DOMString value)
                                        raises(DOMException);
    void               removeAttribute(in DOMString name)
                                        raises(DOMException);
    Attr               getAttributeNode(in DOMString name);
    Attr               setAttributeNode(in Attr newAttr)
                                        raises(DOMException);
    Attr               removeAttributeNode(in Attr oldAttr)
                                        raises(DOMException);
    NodeList           getElementsByTagName(in DOMString name);
    // Introduced in DOM Level 2:
    DOMString          getAttributeNS(in DOMString namespaceURI,
                                      in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    void               setAttributeNS(in DOMString namespaceURI,
                                      in DOMString qualifiedName,
                                      in DOMString value)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    void               removeAttributeNS(in DOMString namespaceURI,
                                         in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Attr               getAttributeNodeNS(in DOMString namespaceURI,
                                          in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Attr               setAttributeNodeNS(in Attr newAttr)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    NodeList           getElementsByTagNameNS(in DOMString namespaceURI,
                                              in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    boolean            hasAttribute(in DOMString name);
    // Introduced in DOM Level 2:
    boolean            hasAttributeNS(in DOMString namespaceURI,
                                      in DOMString localName)
                                        raises(DOMException);
    // Introduced in DOM Level 3:
    readonly attribute TypeInfo        schemaTypeInfo;
    // Introduced in DOM Level 3:
    void               setIdAttribute(in DOMString name,
                                      in boolean isId)
                                        raises(DOMException);
    // Introduced in DOM Level 3:
    void               setIdAttributeNS(in DOMString namespaceURI,
                                        in DOMString localName,
                                        in boolean isId)
                                        raises(DOMException);
    // Introduced in DOM Level 3:
    void               setIdAttributeNode(in Attr idAttr,
                                          in boolean isId)
                                        raises(DOMException);
  };

  interface Text : CharacterData {
    Text               splitText(in unsigned long offset)
                                        raises(DOMException);
    // Introduced in DOM Level 3:
    readonly attribute boolean         isElementContentWhitespace;
    // Introduced in DOM Level 3:
    readonly attribute DOMString       wholeText;
    // Introduced in DOM Level 3:
    Text               replaceWholeText(in DOMString content)
                                        raises(DOMException);
  };

  interface Comment : CharacterData {
  };

  // Introduced in DOM Level 3:
  interface TypeInfo {
    readonly attribute DOMString       typeName;
    readonly attribute DOMString       typeNamespace;

    // DerivationMethods
    const unsigned long       DERIVATION_RESTRICTION         = 0x00000001;
    const unsigned long       DERIVATION_EXTENSION           = 0x00000002;
    const unsigned long       DERIVATION_UNION               = 0x00000004;
    const unsigned long       DERIVATION_LIST                = 0x00000008;

    boolean            isDerivedFrom(in DOMString typeNamespaceArg,
                                     in DOMString typeNameArg,
                                     in unsigned long derivationMethod);
  };
*/</span>
<span class="comment">// Introduced in DOM Level 3:</span>
core.UserDataHandler = <span class="keyword">function</span>() {};
core.UserDataHandler.prototype.NODE_CLONED   = <span class="number">1</span>;
core.UserDataHandler.prototype.NODE_IMPORTED = <span class="number">2</span>;
core.UserDataHandler.prototype.NODE_DELETED  = <span class="number">3</span>;
core.UserDataHandler.prototype.NODE_RENAMED  = <span class="number">4</span>;
core.UserDataHandler.prototype.NODE_ADOPTED  = <span class="number">5</span>;
core.UserDataHandler.prototype.handle = <span class="keyword">function</span>(operation, key, data, src, dst) {};

<span class="comment">// Introduced in DOM Level 3:</span>
core.DOMError = <span class="keyword">function</span>(severity, message, type, relatedException, relatedData, location) {
  <span class="keyword">this</span>._severity         = severity;
  <span class="keyword">this</span>._message          = message;
  <span class="keyword">this</span>._type             = type;
  <span class="keyword">this</span>._relatedException = relatedException;
  <span class="keyword">this</span>._relatedData      = relatedData;
  <span class="keyword">this</span>._location         = location;
};
core.DOMError.prototype = {};
core.DOMError.prototype.SEVERITY_WARNING     = <span class="number">1</span>;
core.DOMError.prototype.SEVERITY_ERROR       = <span class="number">2</span>;
core.DOMError.prototype.SEVERITY_FATAL_ERROR = <span class="number">3</span>;
core.DOMError.prototype.__defineGetter__(<span class="string">'severity'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._severity;
});
core.DOMError.prototype.__defineGetter__(<span class="string">'message'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._message;
});
core.DOMError.prototype.__defineGetter__(<span class="string">'type'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._type;
});
core.DOMError.prototype.__defineGetter__(<span class="string">'relatedException'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._relatedException;
});
core.DOMError.prototype.__defineGetter__(<span class="string">'relatedData'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._relatedData;
});
core.DOMError.prototype.__defineGetter__(<span class="string">'location'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._location;
});

<span class="comment">/*
  // Introduced in DOM Level 3:
  interface DOMErrorHandler {
    boolean            handleError(in DOMError error);
  };

  // Introduced in DOM Level 3:
  interface DOMLocator {
    readonly attribute long            lineNumber;
    readonly attribute long            columnNumber;
    readonly attribute long            byteOffset;
    readonly attribute long            utf16Offset;
    readonly attribute Node            relatedNode;
    readonly attribute DOMString       uri;
  };
*/</span>

<span class="comment">// Introduced in DOM Level 3:</span>
core.DOMConfiguration = <span class="keyword">function</span>(){
  <span class="keyword">var</span> possibleParameterNames = {
    <span class="string">'canonical-form'</span>: [<span class="literal">false</span>, <span class="literal">true</span>], <span class="comment">// extra rules for true</span>
    <span class="string">'cdata-sections'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="string">'check-character-normalization'</span>: [<span class="literal">false</span>, <span class="literal">true</span>],
    <span class="string">'comments'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="string">'datatype-normalization'</span>: [<span class="literal">false</span>, <span class="literal">true</span>],
    <span class="string">'element-content-whitespace'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="string">'entities'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="comment">// 'error-handler': [],</span>
    <span class="string">'infoset'</span>: [<span class="literal">undefined</span>, <span class="literal">true</span>, <span class="literal">false</span>], <span class="comment">// extra rules for true</span>
    <span class="string">'namespaces'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="string">'namespace-declarations'</span>: [<span class="literal">true</span>, <span class="literal">false</span>], <span class="comment">// only checked if namespaces is true</span>
    <span class="string">'normalize-characters'</span>: [<span class="literal">false</span>, <span class="literal">true</span>],
    <span class="comment">// 'schema-location': [],</span>
    <span class="comment">// 'schema-type': [],</span>
    <span class="string">'split-cdata-sections'</span>: [<span class="literal">true</span>, <span class="literal">false</span>],
    <span class="string">'validate'</span>: [<span class="literal">false</span>, <span class="literal">true</span>],
    <span class="string">'validate-if-schema'</span>: [<span class="literal">false</span>, <span class="literal">true</span>],
    <span class="string">'well-formed'</span>: [<span class="literal">true</span>, <span class="literal">false</span>]
  }
};

core.DOMConfiguration.prototype = {
  setParameter: <span class="keyword">function</span>(name, value) {},
  getParameter: <span class="keyword">function</span>(name) {},
  canSetParameter: <span class="keyword">function</span>(name, value) {},
  parameterNames: <span class="keyword">function</span>() {}
};

<span class="comment">//core.Document.prototype._domConfig = new core.DOMConfiguration();</span>
core.Document.prototype.__defineGetter__(<span class="string">'domConfig'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._domConfig || <span class="keyword">new</span> core.DOMConfiguration();;
});

<span class="comment">// Introduced in DOM Level 3:</span>
core.DOMStringList = <span class="keyword">function</span>() {};

core.DOMStringList.prototype = {
  item: <span class="keyword">function</span>() {},
  length: <span class="keyword">function</span>() {},
  contains: <span class="keyword">function</span>() {}
};


<span class="comment">/*
  interface CDATASection : Text {
  };

  interface DocumentType : Node {
    readonly attribute DOMString       name;
    readonly attribute NamedNodeMap    entities;
    readonly attribute NamedNodeMap    notations;
    // Introduced in DOM Level 2:
    readonly attribute DOMString       publicId;
    // Introduced in DOM Level 2:
    readonly attribute DOMString       systemId;
    // Introduced in DOM Level 2:
    readonly attribute DOMString       internalSubset;
  };

  interface Notation : Node {
    readonly attribute DOMString       publicId;
    readonly attribute DOMString       systemId;
  };

  interface Entity : Node {
    readonly attribute DOMString       publicId;
    readonly attribute DOMString       systemId;
    readonly attribute DOMString       notationName;
    // Introduced in DOM Level 3:
    readonly attribute DOMString       inputEncoding;
    // Introduced in DOM Level 3:
    readonly attribute DOMString       xmlEncoding;
    // Introduced in DOM Level 3:
    readonly attribute DOMString       xmlVersion;
  };

  interface EntityReference : Node {
  };

  interface ProcessingInstruction : Node {
    readonly attribute DOMString       target;
             attribute DOMString       data;
                                        // raises(DOMException) on setting

  };

  interface DocumentFragment : Node {
  };

  interface Document : Node {
    // Modified in DOM Level 3:
    readonly attribute DocumentType    doctype;
    readonly attribute DOMImplementation implementation;
    readonly attribute Element         documentElement;
    Element            createElement(in DOMString tagName)
                                        raises(DOMException);
    DocumentFragment   createDocumentFragment();
    Text               createTextNode(in DOMString data);
    Comment            createComment(in DOMString data);
    CDATASection       createCDATASection(in DOMString data)
                                        raises(DOMException);
    ProcessingInstruction createProcessingInstruction(in DOMString target,
                                                      in DOMString data)
                                        raises(DOMException);
    Attr               createAttribute(in DOMString name)
                                        raises(DOMException);
    EntityReference    createEntityReference(in DOMString name)
                                        raises(DOMException);
    NodeList           getElementsByTagName(in DOMString tagname);
    // Introduced in DOM Level 2:
    Node               importNode(in Node importedNode,
                                  in boolean deep)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Element            createElementNS(in DOMString namespaceURI,
                                       in DOMString qualifiedName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    Attr               createAttributeNS(in DOMString namespaceURI,
                                         in DOMString qualifiedName)
                                        raises(DOMException);
    // Introduced in DOM Level 2:
    NodeList           getElementsByTagNameNS(in DOMString namespaceURI,
                                              in DOMString localName);
    // Introduced in DOM Level 2:
    Element            getElementById(in DOMString elementId);
*/</span>

<span class="comment">// Introduced in DOM Level 3:</span>
core.Document.prototype._inputEncoding = <span class="literal">null</span>;
core.Document.prototype.__defineGetter__(<span class="string">'inputEncoding'</span>, <span class="keyword">function</span>() {
  <span class="keyword">return</span> <span class="keyword">this</span>._inputEncoding;
});
<span class="comment">/*
    // Introduced in DOM Level 3:
    readonly attribute DOMString       xmlEncoding;
    // Introduced in DOM Level 3:
             attribute boolean         xmlStandalone;
                                        // raises(DOMException) on setting

    // Introduced in DOM Level 3:
             attribute DOMString       xmlVersion;
                                        // raises(DOMException) on setting

    // Introduced in DOM Level 3:
             attribute boolean         strictErrorChecking;
    // Introduced in DOM Level 3:
             attribute DOMString       documentURI;
    // Introduced in DOM Level 3:
    Node               adoptNode(in Node source)
                                        raises(DOMException);
    // Introduced in DOM Level 3:
    readonly attribute DOMConfiguration domConfig;
    // Introduced in DOM Level 3:
    void               normalizeDocument();
    // Introduced in DOM Level 3:
    Node               renameNode(in Node n,
                                  in DOMString namespaceURI,
                                  in DOMString qualifiedName)
                                        raises(DOMException);
  };
};

#endif // _DOM_IDL_
*/</span>

exports.dom = {
  level3 : {
    core: core
  }
};
</code></pre>