<h1>ruby.js</h1>
<pre><code class="lang-js">module.exports = <span class="keyword">function</span>(hljs) {
  <span class="keyword">var</span> RUBY_IDENT_RE = <span class="string">'[a-zA-Z_][a-zA-Z0-9_]*(\\!|\\?)?'</span>;
  <span class="keyword">var</span> RUBY_METHOD_RE = <span class="string">'[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|&lt;&lt;|>>|=~|===?|&lt;=>|[&lt;>]=?|\\*\\*|[-/+%^&amp;*~`|]|\\[\\]=?'</span>;
  <span class="keyword">var</span> RUBY_KEYWORDS = {
    keyword:
      <span class="string">'and false then defined module in return redo if BEGIN retry end for true self when '</span> +
      <span class="string">'next until do begin unless END rescue nil else break undef not super class case '</span> +
      <span class="string">'require yield alias while ensure elsif or include'</span>
  };
  <span class="keyword">var</span> YARDOCTAG = {
    className: <span class="string">'yardoctag'</span>,
    begin: <span class="string">'@[A-Za-z]+'</span>
  };
  <span class="keyword">var</span> COMMENTS = [
    {
      className: <span class="string">'comment'</span>,
      begin: <span class="string">'#'</span>, end: <span class="string">'$'</span>,
      contains: [YARDOCTAG]
    },
    {
      className: <span class="string">'comment'</span>,
      begin: <span class="string">'^\\=begin'</span>, end: <span class="string">'^\\=end'</span>,
      contains: [YARDOCTAG],
      relevance: <span class="number">10</span>
    },
    {
      className: <span class="string">'comment'</span>,
      begin: <span class="string">'^__END__'</span>, end: <span class="string">'\\n$'</span>
    }
  ];
  <span class="keyword">var</span> SUBST = {
    className: <span class="string">'subst'</span>,
    begin: <span class="string">'#\\{'</span>, end: <span class="string">'}'</span>,
    lexems: RUBY_IDENT_RE,
    keywords: RUBY_KEYWORDS
  };
  <span class="keyword">var</span> STR_CONTAINS = [hljs.BACKSLASH_ESCAPE, SUBST];
  <span class="keyword">var</span> STRINGS = [
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'\''</span>, end: <span class="string">'\''</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">0</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'"'</span>, end: <span class="string">'"'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">0</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?\\('</span>, end: <span class="string">'\\)'</span>,
      contains: STR_CONTAINS
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?\\['</span>, end: <span class="string">'\\]'</span>,
      contains: STR_CONTAINS
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?{'</span>, end: <span class="string">'}'</span>,
      contains: STR_CONTAINS
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?&lt;'</span>, end: <span class="string">'>'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">10</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?/'</span>, end: <span class="string">'/'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">10</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?%'</span>, end: <span class="string">'%'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">10</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?-'</span>, end: <span class="string">'-'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">10</span>
    },
    {
      className: <span class="string">'string'</span>,
      begin: <span class="string">'%[qw]?\\|'</span>, end: <span class="string">'\\|'</span>,
      contains: STR_CONTAINS,
      relevance: <span class="number">10</span>
    }
  ];
  <span class="keyword">var</span> FUNCTION = {
    className: <span class="string">'function'</span>,
    beginWithKeyword: <span class="literal">true</span>, end: <span class="string">' |$|;'</span>,
    keywords: <span class="string">'def'</span>,
    contains: [
      {
        className: <span class="string">'title'</span>,
        begin: RUBY_METHOD_RE,
        lexems: RUBY_IDENT_RE,
        keywords: RUBY_KEYWORDS
      },
      {
        className: <span class="string">'params'</span>,
        begin: <span class="string">'\\('</span>, end: <span class="string">'\\)'</span>,
        lexems: RUBY_IDENT_RE,
        keywords: RUBY_KEYWORDS
      }
    ].concat(COMMENTS)
  };

  <span class="keyword">var</span> RUBY_DEFAULT_CONTAINS = COMMENTS.concat(STRINGS.concat([
    {
      className: <span class="string">'class'</span>,
      beginWithKeyword: <span class="literal">true</span>, end: <span class="string">'$|;'</span>,
      keywords: <span class="string">'class module'</span>,
      contains: [
        {
          className: <span class="string">'title'</span>,
          begin: <span class="string">'[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?'</span>,
          relevance: <span class="number">0</span>
        },
        {
          className: <span class="string">'inheritance'</span>,
          begin: <span class="string">'&lt;\\s*'</span>,
          contains: [{
            className: <span class="string">'parent'</span>,
            begin: <span class="string">'('</span> + hljs.IDENT_RE + <span class="string">'::)?'</span> + hljs.IDENT_RE
          }]
        }
      ].concat(COMMENTS)
    },
    FUNCTION,
    {
      className: <span class="string">'constant'</span>,
      begin: <span class="string">'(::)?(\\b[A-Z]\\w*(::)?)+'</span>,
      relevance: <span class="number">0</span>
    },
    {
      className: <span class="string">'symbol'</span>,
      begin: <span class="string">':'</span>,
      contains: STRINGS.concat([{begin: RUBY_IDENT_RE}]),
      relevance: <span class="number">0</span>
    },
    {
      className: <span class="string">'number'</span>,
      begin: <span class="string">'(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b'</span>,
      relevance: <span class="number">0</span>
    },
    {
      className: <span class="string">'number'</span>,
      begin: <span class="string">'\\?\\w'</span>
    },
    {
      className: <span class="string">'variable'</span>,
      begin: <span class="string">'(\\$\\W)|((\\$|\\@\\@?)(\\w+))'</span>
    },
    { <span class="comment">// regexp container</span>
      begin: <span class="string">'('</span> + hljs.RE_STARTERS_RE + <span class="string">')\\s*'</span>,
      contains: COMMENTS.concat([
        {
          className: <span class="string">'regexp'</span>,
          begin: <span class="string">'/'</span>, end: <span class="string">'/[a-z]*'</span>,
          illegal: <span class="string">'\\n'</span>,
          contains: [hljs.BACKSLASH_ESCAPE]
        }
      ]),
      relevance: <span class="number">0</span>
    }
  ]));
  SUBST.contains = RUBY_DEFAULT_CONTAINS;
  FUNCTION.contains[<span class="number">1</span>].contains = RUBY_DEFAULT_CONTAINS;

  <span class="keyword">return</span> {
    lexems: RUBY_IDENT_RE,
    keywords: RUBY_KEYWORDS,
    contains: RUBY_DEFAULT_CONTAINS
  };
};</code></pre>