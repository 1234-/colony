<h1>index.js</h1>
<pre><code class="lang-js"><span class="comment">/*!
 * Tobi - Cookie
 * Copyright(c) 2010 LearnBoost &lt;dev@learnboost.com>
 * MIT Licensed
 */</span>

<span class="comment">/**
 * Module dependencies.
 */</span>

<span class="keyword">var</span> url = require(<span class="string">'url'</span>);

<span class="comment">/**
 * Initialize a new `Cookie` with the given cookie `str` and `req`.
 *
 * @param {String} str
 * @param {IncomingRequest} req
 * @api private
 */</span>

<span class="keyword">var</span> Cookie = exports = module.exports = <span class="function"><span class="keyword">function</span> <span class="title">Cookie</span><span class="params">(str, req)</span> {</span>
  <span class="keyword">this</span>.str = str;

  <span class="comment">// Map the key/val pairs</span>
  str.split(<span class="regexp">/ *; */</span>).reduce(<span class="keyword">function</span>(obj, pair){
   <span class="keyword">var</span> p = pair.indexOf(<span class="string">'='</span>);
   <span class="keyword">var</span> key = p > <span class="number">0</span> ? pair.substring(<span class="number">0</span>, p).trim() : pair.trim();
   <span class="keyword">var</span> lowerCasedKey = key.toLowerCase();
   <span class="keyword">var</span> value = p > <span class="number">0</span> ? pair.substring(p + <span class="number">1</span>).trim() : <span class="literal">true</span>;

   <span class="keyword">if</span> (!obj.name) {
    <span class="comment">// First key is the name</span>
    obj.name = key;
    obj.value = value;
   }
   <span class="keyword">else</span> <span class="keyword">if</span> (lowerCasedKey === <span class="string">'httponly'</span>) {
    obj.httpOnly = value;
   }
   <span class="keyword">else</span> {
    obj[lowerCasedKey] = value;
   }
   <span class="keyword">return</span> obj;
  }, <span class="keyword">this</span>);

  <span class="comment">// Expires</span>
  <span class="keyword">this</span>.expires = <span class="keyword">this</span>.expires
    ? <span class="keyword">new</span> Date(<span class="keyword">this</span>.expires)
    : <span class="literal">Infinity</span>;

  <span class="comment">// Default or trim path</span>
  <span class="keyword">this</span>.path = <span class="keyword">this</span>.path
    ? <span class="keyword">this</span>.path.trim(): req 
    ? url.parse(req.url).pathname: <span class="string">'/'</span>;
};

<span class="comment">/**
 * Return the original cookie string.
 *
 * @return {String}
 * @api public
 */</span>

Cookie.prototype.toString = <span class="keyword">function</span>(){
  <span class="keyword">return</span> <span class="keyword">this</span>.str;
};
</code></pre>