<h1>clone.js</h1>
<pre><code class="lang-js"><span class="comment">//.CommonJS</span>
<span class="keyword">var</span> CSSOM = {
	CSSStyleSheet: require(<span class="string">"./CSSStyleSheet"</span>).CSSStyleSheet,
	CSSStyleRule: require(<span class="string">"./CSSStyleRule"</span>).CSSStyleRule,
	CSSMediaRule: require(<span class="string">"./CSSMediaRule"</span>).CSSMediaRule,
	CSSStyleDeclaration: require(<span class="string">"./CSSStyleDeclaration"</span>).CSSStyleDeclaration,
	CSSKeyframeRule: require(<span class="string">'./CSSKeyframeRule'</span>).CSSKeyframeRule,
	CSSKeyframesRule: require(<span class="string">'./CSSKeyframesRule'</span>).CSSKeyframesRule
};
<span class="comment">///CommonJS</span>


<span class="comment">/**
 * Produces a deep copy of stylesheet â€” the instance variables of stylesheet are copied recursively.
 * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet
 * @nosideeffects
 * @return {CSSOM.CSSStyleSheet}
 */</span>
CSSOM.clone = <span class="function"><span class="keyword">function</span> <span class="title">clone</span><span class="params">(stylesheet)</span> {</span>

	<span class="keyword">var</span> cloned = <span class="keyword">new</span> CSSOM.CSSStyleSheet;

	<span class="keyword">var</span> rules = stylesheet.cssRules;
	<span class="keyword">if</span> (!rules) {
		<span class="keyword">return</span> cloned;
	}

	<span class="keyword">var</span> RULE_TYPES = {
		<span class="number">1</span>: CSSOM.CSSStyleRule,
		<span class="number">4</span>: CSSOM.CSSMediaRule,
		<span class="comment">//3: CSSOM.CSSImportRule,</span>
		<span class="comment">//5: CSSOM.CSSFontFaceRule,</span>
		<span class="comment">//6: CSSOM.CSSPageRule,</span>
		<span class="number">8</span>: CSSOM.CSSKeyframesRule,
		<span class="number">9</span>: CSSOM.CSSKeyframeRule
	};

	<span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>, rulesLength=rules.length; i &lt; rulesLength; i++) {
		<span class="keyword">var</span> rule = rules[i];
		<span class="keyword">var</span> ruleClone = cloned.cssRules[i] = <span class="keyword">new</span> RULE_TYPES[rule.type];

		<span class="keyword">var</span> style = rule.style;
		<span class="keyword">if</span> (style) {
			<span class="keyword">var</span> styleClone = ruleClone.style = <span class="keyword">new</span> CSSOM.CSSStyleDeclaration;
			<span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>, styleLength=style.length; j &lt; styleLength; j++) {
				<span class="keyword">var</span> name = styleClone[j] = style[j];
				styleClone[name] = style[name];
				styleClone._importants[name] = style.getPropertyPriority(name);
			}
			styleClone.length = style.length;
		}

		<span class="keyword">if</span> (rule.hasOwnProperty(<span class="string">'keyText'</span>)) {
			ruleClone.keyText = rule.keyText;
		}

		<span class="keyword">if</span> (rule.hasOwnProperty(<span class="string">'selectorText'</span>)) {
			ruleClone.selectorText = rule.selectorText;
		}

		<span class="keyword">if</span> (rule.hasOwnProperty(<span class="string">'mediaText'</span>)) {
			ruleClone.mediaText = rule.mediaText;
		}

		<span class="keyword">if</span> (rule.hasOwnProperty(<span class="string">'cssRules'</span>)) {
			ruleClone.cssRules = clone(rule).cssRules;
		}
	}

	<span class="keyword">return</span> cloned;

};

<span class="comment">//.CommonJS</span>
exports.clone = CSSOM.clone;
<span class="comment">///CommonJS</span>
</code></pre>