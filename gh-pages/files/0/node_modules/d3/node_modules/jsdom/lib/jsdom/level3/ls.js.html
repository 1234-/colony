<h1>ls.js</h1>
<pre><code class="lang-js"><span class="comment">// w3c Load/Save functionality: http://www.w3.org/TR/2004/REC-DOM-Level-3-LS-20040407/</span>

<span class="keyword">var</span> core = require(<span class="string">'./core'</span>).dom.level3.core;
<span class="keyword">var</span> events = require(<span class="string">'./events'</span>).dom.level3.events;;

<span class="keyword">var</span> ls = {};

<span class="comment">// TODO: what is this?</span>
<span class="comment">//typedef dom::DOMConfiguration DOMConfiguration;</span>

ls.LSException = <span class="function"><span class="keyword">function</span> <span class="title">LSException</span><span class="params">(code)</span> {</span>
  <span class="keyword">this</span>.code = code;
};

ls.LSException.prototype = {
  <span class="comment">// LSExceptionCode</span>
  PARSE_ERR                       : <span class="number">81</span>,
  SERIALIZE_ERR                   : <span class="number">82</span>
};

ls.DOMImplementationLS = <span class="function"><span class="keyword">function</span> <span class="title">DOMImplementationLS</span><span class="params">()</span> {</span>

};

<span class="keyword">var</span> DOMImplementationExtension = {

  <span class="comment">// DOMImplementationLSMode</span>
  MODE_SYNCHRONOUS  : <span class="number">1</span>,
  MODE_ASYNCHRONOUS : <span class="number">2</span>,

  <span class="comment">// raises(dom::DOMException);</span>
  createLSParser : <span class="keyword">function</span>(<span class="comment">/* int */</span> mode, <span class="comment">/* string */</span> schemaType) {
    <span class="keyword">return</span> <span class="keyword">new</span> ls.LSParser(mode, schemaType);
  },

  createLSSerializer : <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> ls.LSSerializer();
  },

  createLSInput : <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> ls.LSInput();
  },

  createLSOutput : <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> ls.LSOutput();
  }
};

Object.keys(DOMImplementationExtension).forEach(<span class="keyword">function</span>(k, v) {
  core.DOMImplementation.prototype[k] = DOMImplementationExtension[k];
});

ls.DOMImplementationLS.prototype = DOMImplementationExtension; 

core.Document.getFeature = <span class="keyword">function</span>() {
  <span class="keyword">return</span> DOMImplementationExtension;
};

ls.LSParser = <span class="function"><span class="keyword">function</span> <span class="title">LSParser</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>._domConfig = <span class="keyword">new</span> core.DOMConfiguration();
};
ls.LSParser.prototype = {
  get domConfig() { <span class="keyword">return</span> <span class="keyword">this</span>._domConfig; },
  get filter() { <span class="keyword">return</span> <span class="keyword">this</span>._filter || <span class="literal">null</span>; },
  set filter(value) { <span class="keyword">this</span>._filter = value; },
  get async() { <span class="keyword">return</span> <span class="keyword">this</span>._async; },
  get busy() { <span class="keyword">return</span> <span class="keyword">this</span>._busy; },

  <span class="comment">// raises(dom::DOMException, LSException);</span>
  parse : <span class="function"><span class="keyword">function</span> <span class="params">(<span class="comment">/* LSInput */</span> input)</span> {</span>
    <span class="keyword">var</span> doc = <span class="keyword">new</span> core.Document();
    doc._inputEncoding = <span class="string">'UTF-16'</span>;
    <span class="keyword">return</span> doc;
  },

  <span class="comment">// raises(dom::DOMException, LSException);</span>
  parseURI : <span class="keyword">function</span>(<span class="comment">/* string */</span> uri) {
    <span class="keyword">return</span> <span class="keyword">new</span> core.Document();
  },

  <span class="comment">// ACTION_TYPES</span>
  ACTION_APPEND_AS_CHILDREN       : <span class="number">1</span>,
  ACTION_REPLACE_CHILDREN         : <span class="number">2</span>,
  ACTION_INSERT_BEFORE            : <span class="number">3</span>,
  ACTION_INSERT_AFTER             : <span class="number">4</span>,
  ACTION_REPLACE                  : <span class="number">5</span>,

  <span class="comment">// @returns Node</span>
  <span class="comment">// @raises DOMException, LSException</span>
  parseWithContext                : <span class="keyword">function</span>(<span class="comment">/* LSInput */</span> input, <span class="comment">/* Node */</span> contextArg, <span class="comment">/* int */</span> action) {
    <span class="keyword">return</span> <span class="keyword">new</span> core.Node();
  },

  abort                           : <span class="keyword">function</span>() {
    <span class="comment">// TODO: implement</span>
  }
};

ls.LSInput = <span class="function"><span class="keyword">function</span> <span class="title">LSInput</span><span class="params">()</span> {</span>};
ls.LSInput.prototype = {
  get characterStream() { <span class="keyword">return</span> <span class="keyword">this</span>._characterStream || <span class="literal">null</span>; },
  set characterStream(value) { <span class="keyword">this</span>._characterStream = value; },
  get byteStream() { <span class="keyword">return</span> <span class="keyword">this</span>._byteStream || <span class="literal">null</span>; },
  set byteStream(value) { <span class="keyword">this</span>._byteStream = value; },
  get stringData() { <span class="keyword">return</span> <span class="keyword">this</span>._stringData || <span class="literal">null</span>; },
  set stringData(value) { <span class="keyword">this</span>._stringData = value; },
  get systemId() { <span class="keyword">return</span> <span class="keyword">this</span>._systemId || <span class="literal">null</span>; },
  set systemId(value) { <span class="keyword">this</span>._systemId = value; },
  get publicId() { <span class="keyword">return</span> <span class="keyword">this</span>._publicId || <span class="literal">null</span>; },
  set publicId(value) { <span class="keyword">this</span>._publicId = value; },
  get baseURI() { <span class="keyword">return</span> <span class="keyword">this</span>._baseURI || <span class="literal">null</span>; },
  set baseURI(value) { <span class="keyword">this</span>._baseURI = value; },
  get encoding() { <span class="keyword">return</span> <span class="keyword">this</span>._encoding || <span class="literal">null</span>; },
  set encoding(value) { <span class="keyword">this</span>._encoding = value; },
  get certifiedText() { <span class="keyword">return</span> <span class="keyword">this</span>._certifiedText || <span class="literal">null</span>; },
  set certifiedText(value) { <span class="keyword">this</span>._certifiedText = value; },
};

ls.LSResourceResolver = <span class="function"><span class="keyword">function</span> <span class="title">LSResourceResolver</span><span class="params">()</span> {</span>};

<span class="comment">// @returns LSInput</span>
ls.LSResourceResolver.prototype.resolveResource = <span class="keyword">function</span>(type, namespaceURI, publicId, systemId, baseURI) {
  <span class="keyword">return</span> <span class="keyword">new</span> ls.LSInput();
};

ls.LSParserFilter = <span class="function"><span class="keyword">function</span> <span class="title">LSParserFilter</span><span class="params">()</span> {</span>};
ls.LSParserFilter.prototype = {

  <span class="comment">// Constants returned by startElement and acceptNode</span>
  FILTER_ACCEPT                   : <span class="number">1</span>,
  FILTER_REJECT                   : <span class="number">2</span>,
  FILTER_SKIP                     : <span class="number">3</span>,
  FILTER_INTERRUPT                : <span class="number">4</span>,

  get whatToShow() { <span class="keyword">return</span> <span class="keyword">this</span>._whatToShow; },

  <span class="comment">// @returns int</span>
  startElement : <span class="keyword">function</span>(<span class="comment">/* Element */</span> elementArg) {
    <span class="keyword">return</span> <span class="number">0</span>;
  },

  <span class="comment">// @returns int</span>
  acceptNode : <span class="keyword">function</span>(<span class="comment">/* Node */</span> nodeArg) {
    <span class="keyword">return</span> nodeArg;
  }
};

ls.LSSerializer = <span class="function"><span class="keyword">function</span> <span class="title">LSSerializer</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>._domConfig = <span class="keyword">new</span> core.DOMConfiguration();
};
ls.LSSerializer.prototype = {
  get domConfig() { <span class="keyword">return</span> <span class="keyword">this</span>._domConfig; },
  get newLine() { <span class="keyword">return</span> <span class="keyword">this</span>._newLine || <span class="literal">null</span>; },
  set newLine(value) { <span class="keyword">this</span>._newLine = value; },
  get filter() { <span class="keyword">return</span> <span class="keyword">this</span>._filter || <span class="literal">null</span>; },
  set filter(value) { <span class="keyword">this</span>._filter = value; },

  <span class="comment">// @returns boolean</span>
  <span class="comment">// @raises LSException</span>
  write : <span class="keyword">function</span>(<span class="comment">/* Node */</span> nodeArg, <span class="comment">/* LSOutput */</span> destination) {
   <span class="keyword">return</span> <span class="literal">true</span>;
  },

  <span class="comment">// @returns boolean</span>
  <span class="comment">// @raises LSException</span>
  writeToURI : <span class="keyword">function</span>(<span class="comment">/* Node */</span> nodeArg, <span class="comment">/* string */</span> uri) {
   <span class="keyword">return</span> <span class="literal">true</span>;
  },

  <span class="comment">// @returns string</span>
  <span class="comment">// @raises DOMException, LSException</span>
  writeToString : <span class="keyword">function</span>(<span class="comment">/* Node */</span> nodeArg) {
    <span class="keyword">return</span> <span class="string">""</span>;
  }
};

ls.LSOutput = <span class="function"><span class="keyword">function</span> <span class="title">LSOutput</span><span class="params">()</span> {</span>};
ls.LSOutput.prototype = {
  get characterStream() { <span class="keyword">return</span> <span class="keyword">this</span>._characterStream || <span class="literal">null</span>; },
  set characterStream(value) { <span class="keyword">this</span>._characterStream = value; },
  get byteStream() { <span class="keyword">return</span> <span class="keyword">this</span>._byteStream || <span class="literal">null</span>; },
  set byteStream(value) { <span class="keyword">this</span>._byteStream = value; },
  get systemId() { <span class="keyword">return</span> <span class="keyword">this</span>._systemId || <span class="literal">null</span>; },
  set systemId(value) { <span class="keyword">this</span>._systemId = value; },
  get encoding() { <span class="keyword">return</span> <span class="keyword">this</span>._encoding || <span class="literal">null</span>; },
  set encoding(value) { <span class="keyword">this</span>._encoding = value; },
};

ls.LSProgressEvent = <span class="function"><span class="keyword">function</span> <span class="title">LSProgressEvent</span><span class="params">()</span> {</span>};
ls.LSProgressEvent.prototype = {
  get input() { <span class="keyword">return</span> <span class="keyword">this</span>._input; },
  get position() { <span class="keyword">return</span> <span class="keyword">this</span>._position; },
  get totalSize() { <span class="keyword">return</span> <span class="keyword">this</span>._totalSize; },
};

ls.LSProgressEvent.prototype.__proto__ = events.Event;

ls.LSLoadEvent = <span class="function"><span class="keyword">function</span> <span class="title">LSLoadEvent</span><span class="params">()</span> {</span>};
ls.LSLoadEvent.prototype = {
  get newDocument() { <span class="keyword">return</span> <span class="keyword">this</span>._newDocument; },
  get input() { <span class="keyword">return</span> <span class="keyword">this</span>._input; },
};

ls.LSLoadEvent.prototype.__proto__ = events.Event;


<span class="comment">// TODO: do traversal</span>
ls.LSSerializerFilter = <span class="function"><span class="keyword">function</span> <span class="title">LSSerializerFilter</span><span class="params">()</span> {</span>};
ls.LSSerializerFilter.prototype = {
  get whatToShow() { <span class="keyword">return</span> <span class="keyword">this</span>._whatToShow; },
};

<span class="comment">// ls.LSSerializerFilter.prototype.__proto__ = level2.traversal.NodeFiler;</span>

<span class="comment">// Export</span>
module.exports.dom = {
  level3 : {
    ls : ls 
  }
};

</code></pre>