<h1>utils.js</h1>
<pre><code class="lang-js"><span class="comment">/**
 * Intercepts a method by replacing the prototype's implementation
 * with a wrapper that invokes the given interceptor instead.
 * 
 *     utils.intercept(core.Element, 'inserBefore',
 *       function(_super, args, newChild, refChild) {
 *         console.log('insertBefore', newChild, refChild);
 *         return _super.apply(this, args);
 *       }
 *     );
 */</span>
exports.intercept = <span class="keyword">function</span>(clazz, method, interceptor) {
  <span class="keyword">var</span> proto = clazz.prototype,
      _super = proto[method],
      unwrapArgs = interceptor.length > <span class="number">2</span>;

  proto[method] = <span class="keyword">function</span>() {
    <span class="keyword">if</span> (unwrapArgs) {
      <span class="keyword">var</span> args = Array.prototype.slice.call(arguments);
      args.unshift(_super, arguments);
      <span class="keyword">return</span> interceptor.apply(<span class="keyword">this</span>, args);
    }
    <span class="keyword">else</span> {
      <span class="keyword">return</span> interceptor.call(<span class="keyword">this</span>, _super, arguments);
    }
  };
};
</code></pre>